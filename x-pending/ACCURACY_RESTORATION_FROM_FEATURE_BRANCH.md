# ç²¾åº¦æ”¹å–„å®Ÿè£…è¨ˆç”»: feature/accuracy-improvements-backup â†’ main + æ–°è¦æ©Ÿèƒ½

## æ¦‚è¦

`feature/accuracy-improvements-backup` ãƒ–ãƒ©ãƒ³ãƒã«å®Ÿè£…æ¸ˆã¿ã®ç²¾åº¦æ”¹å–„ã‚’mainãƒ–ãƒ©ãƒ³ãƒã«æ®µéšçš„ã«é©ç”¨ + æ–°è¦æ©Ÿèƒ½è¿½åŠ ã€‚

**å¯¾è±¡å•é¡Œ:**
- 8äººåˆ¶ã‚µãƒƒã‚«ãƒ¼ã§4-4-2ï¼ˆ11äººåˆ¶ï¼‰ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå‡ºåŠ›ã•ã‚Œã‚‹
- ã‚´ãƒ¼ãƒ«ã‚·ãƒ¼ãƒ³ãŒã‚µãƒãƒªãƒ¼ã§è¨€åŠã•ã‚Œãªã„
- ã‚¤ãƒ™ãƒ³ãƒˆèª¤æ¤œå‡ºãŒå¤šã„
- æˆ¦è¡“åˆ†æãŒè‹±èªã§å‡ºåŠ›ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚‹
- **å…¨ä½“çš„ãªåˆ†æç²¾åº¦ãŒä½ã„**
- **ã‚¢ã‚·ã‚¹ãƒˆãŒè¨˜éŒ²ã•ã‚Œã¦ã„ãªã„**ï¼ˆä¸¡ãƒ–ãƒ©ãƒ³ãƒæœªå®Ÿè£…ï¼‰
- **ã‚¤ãƒ™ãƒ³ãƒˆä½ç½®ãŒã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒ“ãƒ¥ãƒ¼ã«åæ˜ ã•ã‚Œã¦ã„ãªã„**
- **æˆ¦è¡“åˆ†æãŒæŒ‡å°è€…ãƒ¬ãƒ™ãƒ«ã§ã¯ãªã„**

**ãƒ–ãƒ©ãƒ³ãƒæ¯”è¼ƒçµæœ:**
- å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°: 144ãƒ•ã‚¡ã‚¤ãƒ«
- è¿½åŠ è¡Œæ•°: +30,399è¡Œ
- ä¸»ãªæ”¹å–„: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€ä¿¡é ¼åº¦é–¾å€¤ã€ã‚¤ãƒ™ãƒ³ãƒˆæ¤œè¨¼ã€ä½ç½®æ¨å®š

**å‚ç…§ãƒ–ãƒ©ãƒ³ãƒ:** `feature/accuracy-improvements-backup`

---

## å…±é€š: feature branch å‚ç…§ã‚³ãƒãƒ³ãƒ‰

```bash
# ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’è¡¨ç¤º
git show feature/accuracy-improvements-backup:path/to/file

# å·®åˆ†ã‚’ç¢ºèª
git diff main..feature/accuracy-improvements-backup -- path/to/file

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
git show feature/accuracy-improvements-backup:path/to/file > path/to/file
```

---

## Phase 1: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°ï¼ˆ8äººåˆ¶å¯¾å¿œãƒ»å³åŠ¹æ€§ã‚ã‚Šï¼‰

### 1.1 tactical_analysis_v1.json ã®æ›´æ–°

- [x] **1.1.1** feature branchã®å®Ÿè£…ã‚’ç¢ºèª âœ…
  ```bash
  git show feature/accuracy-improvements-backup:services/analyzer/src/gemini/prompts/tactical_analysis_v1.json
  ```
  - [x] ç¢ºèªå®Œäº†: ã€Œå‹•ç”»è¦³å¯Ÿå„ªå…ˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å†…å®¹ã‚’æŠŠæ¡
  - [x] ç¢ºèªå®Œäº†: 8äººåˆ¶ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒªã‚¹ãƒˆã‚’æŠŠæ¡
  - [x] ç¢ºèªå®Œäº†: 8äººåˆ¶ãƒ†ãƒ³ãƒã‚¹ã‚±ãƒ¼ãƒ«ã‚’æŠŠæ¡
  - [x] ç¢ºèªå®Œäº†: 8äººåˆ¶ã‚µãƒ³ãƒ—ãƒ«ä¾‹ã®æ§‹é€ ã‚’æŠŠæ¡

- [x] **1.1.2** ã€Œå‹•ç”»è¦³å¯Ÿå„ªå…ˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ  âœ…
  ```json
  "instructions": "...\n\n## â˜…â˜…â˜… é‡è¦: å‹•ç”»è¦³å¯Ÿå„ªå…ˆ â˜…â˜…â˜…\n\nä»¥ä¸‹ã®æƒ…å ±ã¯**å‹•ç”»ã‹ã‚‰ç›´æ¥è¦³å¯Ÿ**ã—ã¦åˆ¤æ–­ã—ã¦ãã ã•ã„ï¼š\n- **ãƒ”ãƒƒãƒä¸Šã®é¸æ‰‹æ•°**: 5äººåˆ¶/7äººåˆ¶/8äººåˆ¶/11äººåˆ¶ã‚’è¦³å¯Ÿã—ã¦åˆ¤æ–­\n- **ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: å®Ÿéš›ã®é¸æ‰‹é…ç½®ã‚’è¦³å¯Ÿï¼ˆä¾‹ã«ç¸›ã‚‰ã‚Œãªã„ã“ã¨ï¼‰\n- **è©¦åˆã®ãƒ†ãƒ³ãƒ**: å½¢å¼ã«ã‚ˆã‚Šãƒ‘ã‚¹/åˆ†ã®åŸºæº–ãŒç•°ãªã‚‹\n\nãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä¾‹ã¯**å‚è€ƒç¨‹åº¦**ã¨ã—ã€**å®Ÿéš›ã®å‹•ç”»å†…å®¹ã‚’å„ªå…ˆ**ã—ã¦ãã ã•ã„ã€‚\n\n---\n\n..."
  ```
  - [x] å®Ÿè£…å®Œäº†
  - [x] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [x] **1.1.3** 8äººåˆ¶ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’guidelinesã«è¿½åŠ  âœ…
  ```json
  "formation_detection": {
    "11v11_common": ["4-4-2", "4-3-3", ...],
    "8v8_common": ["3-3-1", "2-3-2", "2-4-1", "3-2-2", "2-2-3", "1-3-3", "1-4-2"],
    "7v7_common": ["3-2-1", "2-3-1", "3-3", "2-2-2"],
    "futsal_common": ["2-2", "1-2-1", "3-1", "4-0"]
  }
  ```
  - [x] å®Ÿè£…å®Œäº†
  - [x] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [x] **1.1.4** 8äººåˆ¶ãƒ†ãƒ³ãƒã‚¹ã‚±ãƒ¼ãƒ«ã‚’è¿½åŠ  âœ…
  ```json
  "tempo_interpretation": {
    "11v11": { "low": "8æœªæº€", "medium": "8-12", "high": "12ä»¥ä¸Š" },
    "8v8": { "low": "9æœªæº€", "medium": "9-14", "high": "14ä»¥ä¸Š" },
    "7v7": { "low": "10æœªæº€", "medium": "10-15", "high": "15ä»¥ä¸Š" },
    "futsal": { "low": "15æœªæº€", "medium": "15-20", "high": "20ä»¥ä¸Š" }
  }
  ```
  - [x] å®Ÿè£…å®Œäº†
  - [x] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [x] **1.1.5** 8äººåˆ¶ã‚µãƒ³ãƒ—ãƒ«ä¾‹ã‚’è¿½åŠ ï¼ˆ3-3-1 vs 2-3-2ï¼‰ âœ…
  - [x] å®Ÿè£…å®Œäº†
  - [x] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [x] **1.1.6** edge_cases ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è©³ç´°åŒ–ï¼ˆ6ã‚±ãƒ¼ã‚¹ï¼‰ âœ…
  ```
  1. ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæµå‹•çš„ãªå ´åˆ
  2. äººæ•°ãŒå°‘ãªã„è©¦åˆ
  3. å‰å¾ŒåŠã§ã‚¹ã‚¿ã‚¤ãƒ«å¤§ããç•°ãªã‚‹
  4. æ˜ åƒãŒéƒ¨åˆ†çš„
  5. ãƒ•ãƒƒãƒˆã‚µãƒ«ã¨11äººåˆ¶ã®æ··åŒ
  6. ãƒ¦ãƒ¼ã‚¹/ã‚¢ãƒãƒãƒ¥ã‚¢ã®ä¸å®‰å®šãªæˆ¦è¡“
  ```
  - [x] å®Ÿè£…å®Œäº†
  - [x] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [x] **1.1.7** å¤‰æ›´å¾Œã®JSONãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ âœ…
  ```bash
  node -e "JSON.parse(require('fs').readFileSync('services/analyzer/src/gemini/prompts/tactical_analysis_v1.json'))"
  ```
  - [x] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸ

- [x] **1.1.8** æœ€çµ‚ç¢ºèª: feature branchã¨ã®å·®åˆ†ãŒãªã„ã“ã¨ã‚’ç¢ºèª âœ…
  - [x] å·®åˆ†ãªã—ç¢ºèªå®Œäº†

### 1.2 match_summary_v1.json ã®æ›´æ–°

- [x] **1.2.1** feature branchã®å®Ÿè£…ã‚’ç¢ºèª âœ…
  ```bash
  git show feature/accuracy-improvements-backup:services/analyzer/src/gemini/prompts/match_summary_v1.json
  ```
  - [x] ç¢ºèªå®Œäº†: ã€Œå‹•ç”»è¦³å¯Ÿå„ªå…ˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å†…å®¹ã‚’æŠŠæ¡
  - [x] ç¢ºèªå®Œäº†: 8äººåˆ¶ã‚µãƒ³ãƒ—ãƒ«ä¾‹ã®æ§‹é€ ã‚’æŠŠæ¡
  - [x] ç¢ºèªå®Œäº†: ã‚´ãƒ¼ãƒ«æ¤œå‡ºå„ªå…ˆåº¦æŒ‡ç¤ºã‚’æŠŠæ¡

- [x] **1.2.2** ã€Œå‹•ç”»è¦³å¯Ÿå„ªå…ˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ  âœ…
  ```
  - ãƒ”ãƒƒãƒä¸Šã®é¸æ‰‹æ•°: 5äººåˆ¶/7äººåˆ¶/8äººåˆ¶/11äººåˆ¶ã‚’è¦³å¯Ÿã—ã¦åˆ¤æ–­
  - è©¦åˆæ™‚é–“: å½¢å¼ã«ã‚ˆã‚Šç•°ãªã‚‹ï¼ˆ11äººåˆ¶:45åˆ†ãƒãƒ¼ãƒ•ã€8äººåˆ¶:15-20åˆ†ãƒãƒ¼ãƒ•ï¼‰
  - ã‚´ãƒ¼ãƒ«ã‚µã‚¤ã‚ºãƒ»ã‚³ãƒ¼ãƒˆã‚µã‚¤ã‚º: è©¦åˆå½¢å¼ã®åˆ¤æ–­ææ–™
  ```
  - [x] å®Ÿè£…å®Œäº†
  - [x] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [x] **1.2.3** 8äººåˆ¶ãƒãƒƒãƒã‚µãƒãƒªãƒ¼ã®ã‚µãƒ³ãƒ—ãƒ«ä¾‹ã‚’è¿½åŠ  âœ…
  - [x] å®Ÿè£…å®Œäº†
  - [x] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [x] **1.2.4** ã‚´ãƒ¼ãƒ«æ¤œå‡ºã®å„ªå…ˆåº¦æŒ‡ç¤ºã‚’å¼·åŒ– âœ…
  ```
  ã‚´ãƒ¼ãƒ«ã‚·ãƒ¼ãƒ³ã¯å¿…ãškeyMomentsã®æœ€ä¸Šä½ã«å«ã‚ã‚‹
  ```
  - [x] å®Ÿè£…å®Œäº†
  - [x] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [x] **1.2.5** JSONãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ âœ…
  - [x] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸ

- [x] **1.2.6** æœ€çµ‚ç¢ºèª: feature branchã¨ã®å·®åˆ†ãŒãªã„ã“ã¨ã‚’ç¢ºèª âœ…
  - [x] å·®åˆ†ãªã—ç¢ºèªå®Œäº†

### 1.3 event_detection_v3.json ã®æ›´æ–°

- [x] **1.3.1** feature branchã®å®Ÿè£…ã‚’ç¢ºèª âœ…
  ```bash
  git show feature/accuracy-improvements-backup:services/analyzer/src/gemini/prompts/event_detection_v3.json
  git diff main..feature/accuracy-improvements-backup -- services/analyzer/src/gemini/prompts/event_detection_v3.json
  ```
  - [x] ç¢ºèªå®Œäº†: ã‚¿ã‚¹ã‚¯èª¬æ˜ã®å¤‰æ›´å†…å®¹ã‚’æŠŠæ¡
  - [x] ç¢ºèªå®Œäº†: ä¿¡é ¼åº¦é–¾å€¤ã®å¤‰æ›´ã‚’æŠŠæ¡
  - [x] ç¢ºèªå®Œäº†: ã€Œå‹•ç”»è¦³å¯Ÿå„ªå…ˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŠŠæ¡

- [x] **1.3.2** ã‚¿ã‚¹ã‚¯èª¬æ˜ã‚’ã€Œaggressiveã€ã‹ã‚‰ã€Œbalanced precisionã€ã«å¤‰æ›´ âœ…
  ```
  FROM: "AGGRESSIVE shot detection"
  TO: "balanced precision. Focus on accuracy over recall"
  ```
  - [x] å®Ÿè£…å®Œäº†
  - [x] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [x] **1.3.3** ã‚·ãƒ¥ãƒ¼ãƒˆä¿¡é ¼åº¦é–¾å€¤ã‚’å¼•ãä¸Šã’ âœ…
  ```
  FROM: 0.3ä»¥ä¸Šã§å ±å‘Š
  TO: 0.5ä»¥ä¸Šã§å ±å‘Š
  ```
  - [x] å®Ÿè£…å®Œäº†
  - [x] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [x] **1.3.4** ã€Œå‹•ç”»è¦³å¯Ÿå„ªå…ˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ  âœ…
  - [x] å®Ÿè£…å®Œäº†
  - [x] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [x] **1.3.5** JSONãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ âœ…
  - [x] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸ

- [x] **1.3.6** æœ€çµ‚ç¢ºèª: feature branchã¨ã®å·®åˆ†ãŒãªã„ã“ã¨ã‚’ç¢ºèª âœ…
  - [x] å·®åˆ†ãªã—ç¢ºèªå®Œäº†

### 1.4 Phase 1 æ¤œè¨¼

- [ ] **1.4.1** ãƒ­ãƒ¼ã‚«ãƒ«ã§analyzerã‚µãƒ¼ãƒ“ã‚¹ã‚’ãƒ“ãƒ«ãƒ‰
  ```bash
  cd services/analyzer && pnpm build
  ```
  - [ ] ãƒ“ãƒ«ãƒ‰æˆåŠŸ

- [ ] **1.4.2** ãƒ†ã‚¹ãƒˆå‹•ç”»ï¼ˆ8äººåˆ¶ï¼‰ã§åˆ†æå®Ÿè¡Œ
  - [ ] åˆ†æå®Œäº†

- [ ] **1.4.3** ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒ8äººåˆ¶å½¢å¼ï¼ˆ3-3-1ç­‰ï¼‰ã§å‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - [ ] ç¢ºèªå®Œäº†

- [ ] **1.4.4** ã‚´ãƒ¼ãƒ«ã‚·ãƒ¼ãƒ³ãŒã‚µãƒãƒªãƒ¼ã«å«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - [ ] ç¢ºèªå®Œäº†

---

## Phase 2: ä¿¡é ¼åº¦é–¾å€¤ãƒ»æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯æ”¹å–„

### 2.1 07b_detectEventsWindowed.ts ã®æ›´æ–°

- [x] **2.1.0** feature branchã®å®Ÿè£…ã‚’ç¢ºèª âœ…
  ```bash
  git diff main..feature/accuracy-improvements-backup -- services/analyzer/src/jobs/steps/07b_detectEventsWindowed.ts
  ```
  - [x] ç¢ºèªå®Œäº†: ä¿¡é ¼åº¦é–¾å€¤ã®å¤‰æ›´ç®‡æ‰€ã‚’æŠŠæ¡
  - [x] ç¢ºèªå®Œäº†: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é‡è¤‡è¨­å®šã‚’æŠŠæ¡
  - [ ] ç¢ºèªå®Œäº†: å‹•çš„ãƒˆãƒ¼ã‚¯ãƒ³è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŠŠæ¡ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰
  - [ ] ç¢ºèªå®Œäº†: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆçµ±åˆãƒ­ã‚¸ãƒƒã‚¯ã‚’æŠŠæ¡ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰
  - [ ] ç¢ºèªå®Œäº†: ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ãƒã‚§ãƒƒã‚¯ã‚’æŠŠæ¡ï¼ˆæ—¢å­˜ã§ååˆ†ï¼‰

- [x] **2.1.1** ä¿¡é ¼åº¦é–¾å€¤ã‚’0.3ã‹ã‚‰0.7ã«å¼•ãä¸Šã’ âœ…
  ```typescript
  // Phase 2.10: é–¾å€¤ã‚’0.7ã«ä¸Šã’ã¦ã‚¤ãƒ™ãƒ³ãƒˆéæ¤œå‡ºã‚’é˜²æ­¢
  confidence: z.number().min(0.7).max(1),
  ```
  - [x] å®Ÿè£…å®Œäº†
  - [x] Zodã‚¹ã‚­ãƒ¼ãƒã¨GEMINI_RESPONSE_SCHEMAä¸¡æ–¹ã§0.7ã«è¨­å®š

- [x] **2.1.2** ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é‡è¤‡ã‚’50%ã‹ã‚‰25%ã«å‰Šæ¸› âœ…
  ```typescript
  // Phase 2.9: 25%ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ã«å‰Šæ¸›ï¼ˆé‡è¤‡æ¤œå‡ºã‚’æ¸›ã‚‰ã™ï¼‰
  overlapSec: 15,  // 60ç§’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®25%
  ```
  - [x] å®Ÿè£…å®Œäº†
  - [x] 30ç§’â†’15ç§’ã«å¤‰æ›´

- [ ] **2.1.3** å‹•çš„ãƒˆãƒ¼ã‚¯ãƒ³è¨ˆç®—ã‚’å®Ÿè£…ï¼ˆã‚¹ã‚­ãƒƒãƒ— - ç¾çŠ¶ã§ååˆ†ï¼‰
  ```typescript
  const videoDurationSec = cache.videoDurationSec || 600;
  const baseTokens = 12288;
  const tokensPerMinute = 800;
  const maxOutputTokens = Math.min(
    32768,
    baseTokens + Math.ceil((videoDurationSec / 60) * tokensPerMinute)
  );
  ```
  - [ ] å®Ÿè£…å®Œäº†
  - [ ] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [ ] **2.1.4** ã‚»ã‚°ãƒ¡ãƒ³ãƒˆçµ±åˆãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ï¼ˆ10ç§’æœªæº€ã‚’çµ±åˆï¼‰
  - [ ] å®Ÿè£…å®Œäº†
  - [ ] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [ ] **2.1.5** ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ã®ã‚»ãƒ¼ãƒ•ãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ 
  - [ ] å®Ÿè£…å®Œäº†
  - [ ] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

- [ ] **2.1.6** å˜ä½“ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
  ```bash
  cd services/analyzer && pnpm test -- 07b_detectEventsWindowed
  ```
  - [ ] ãƒ†ã‚¹ãƒˆæˆåŠŸ

### 2.2 gemini3Client.ts ã®æ”¹å–„

- [ ] **2.2.0** feature branchã®å®Ÿè£…ã‚’ç¢ºèª
  ```bash
  git diff main..feature/accuracy-improvements-backup -- services/analyzer/src/gemini/gemini3Client.ts
  ```
  - [ ] ç¢ºèªå®Œäº†: APIã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå®Ÿè£…ã‚’æŠŠæ¡
  - [ ] ç¢ºèªå®Œäº†: AbortControllerä½¿ç”¨æ–¹æ³•ã‚’æŠŠæ¡

- [ ] **2.2.1** APIã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ5åˆ†ï¼‰ã‚’è¿½åŠ 
  ```typescript
  const GEMINI_API_TIMEOUT_MS = 300_000;
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), GEMINI_API_TIMEOUT_MS);
  ```
  - [ ] å®Ÿè£…å®Œäº†
  - [ ] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

### 2.3 summaryAndTactics.ts ã®èª¿æ•´

- [ ] **2.3.0** feature branchã®å®Ÿè£…ã‚’ç¢ºèª
  ```bash
  git diff main..feature/accuracy-improvements-backup -- services/analyzer/src/gemini/summaryAndTactics.ts
  ```

- [ ] **2.3.1** maxOutputTokensã‚’16384ã‹ã‚‰8192ã«å‰Šæ¸›
  - [ ] å®Ÿè£…å®Œäº†
  - [ ] feature branchã¨å·®åˆ†æ¯”è¼ƒã§ä¸€è‡´ç¢ºèª

### 2.4 Phase 2 æ¤œè¨¼

- [x] **2.4.1** ãƒ“ãƒ«ãƒ‰æˆåŠŸã‚’ç¢ºèª âœ… (`pnpm typecheck` æˆåŠŸ)
- [ ] **2.4.2** ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡ºæ•°ãŒé©åˆ‡ã«æ¸›å°‘ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆå¿…è¦ï¼‰
- [ ] **2.4.3** èª¤æ¤œå‡ºç‡ã®æ”¹å–„ã‚’ç¢ºèªï¼ˆå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆå¿…è¦ï¼‰

---

## Phase 3: ä½ç½®æ¨å®šæ©Ÿèƒ½ã®è¿½åŠ 

### 3.1 event_detection_v4.json ã®è¿½åŠ 

- [x] **3.1.0** feature branchã®å®Ÿè£…ã‚’ç¢ºèª âœ…
  ```bash
  git show feature/accuracy-improvements-backup:services/analyzer/src/gemini/prompts/event_detection_v4.json
  ```
  - [x] ç¢ºèªå®Œäº†: ä½ç½®æ¨å®šã‚¹ã‚­ãƒ¼ãƒã‚’æŠŠæ¡
  - [x] ç¢ºèªå®Œäº†: åº§æ¨™ç³»ï¼ˆ0-100ï¼‰ã‚’æŠŠæ¡

- [x] **3.1.1** feature branchã‹ã‚‰v4ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ âœ…
  ```bash
  git show feature/accuracy-improvements-backup:services/analyzer/src/gemini/prompts/event_detection_v4.json > services/analyzer/src/gemini/prompts/event_detection_v4.json
  ```
  - [x] ã‚³ãƒ”ãƒ¼å®Œäº†
  - [x] feature branchã¨å®Œå…¨ä¸€è‡´ç¢ºèª

- [x] **3.1.2** ä½ç½®æ¨å®šã‚¹ã‚­ãƒ¼ãƒã®ç¢ºèª âœ…
  ```json
  "position": {
    "x": "0-100 (0=è‡ªé™£ã‚´ãƒ¼ãƒ«, 100=ç›¸æ‰‹ã‚´ãƒ¼ãƒ«)",
    "y": "0-100 (0=ä¸Šã‚¿ãƒƒãƒãƒ©ã‚¤ãƒ³, 100=ä¸‹ã‚¿ãƒƒãƒãƒ©ã‚¤ãƒ³)",
    "confidence": "0.3-1.0"
  }
  ```
  - [x] ã‚¹ã‚­ãƒ¼ãƒç¢ºèªå®Œäº†

### 3.2 07b_detectEventsWindowed.ts ã¸ã®ä½ç½®æ¨å®šçµ±åˆ

- [x] **3.2.0** feature branchã®ä½ç½®æ¨å®šå®Ÿè£…ã‚’ç¢ºèª âœ…
- [x] **3.2.1** RawEventå‹ã«ä½ç½®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ  âœ…
  ```typescript
  // Phase 3: Position estimation (v4)
  position?: { x: number; y: number };  // Normalized 0-100 coordinates
  positionConfidence?: number;  // 0-1 confidence in position estimate
  ```
  - [x] å®Ÿè£…å®Œäº†
  - [x] Zodã‚¹ã‚­ãƒ¼ãƒã«ã‚‚ PositionSchema è¿½åŠ 

- [x] **3.2.2** ä½ç½®æ­£è¦åŒ–ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£… âœ…
  - [x] 0-100ç¯„å›²ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
  - [x] ã‚¤ãƒ™ãƒ³ãƒˆå¤‰æ›æ™‚ã« position ã¨ positionConfidence ã‚’è¨­å®š

- [x] **3.2.3** NaN/Infinity ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ  âœ…
  - [x] `Number.isNaN()` ãƒã‚§ãƒƒã‚¯å®Ÿè£…

- [x] **3.2.4** PROMPT_VERSION ã‚’ v3 â†’ v4 ã«æ›´æ–° âœ…
- [x] **3.2.5** GEMINI_RESPONSE_SCHEMA ã« position ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ  âœ…

### 3.3 Phase 3 æ¤œè¨¼

- [x] **3.3.1** ãƒ“ãƒ«ãƒ‰æˆåŠŸã‚’ç¢ºèª âœ… (`pnpm typecheck` æˆåŠŸ)
- [ ] **3.3.2** ã‚¤ãƒ™ãƒ³ãƒˆã«ä½ç½®æƒ…å ±ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆå¿…è¦ï¼‰
- [ ] **3.3.3** ä½ç½®åº§æ¨™ãŒ0-100ã®ç¯„å›²å†…ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆå¿…è¦ï¼‰

---

## Phase 4: ã‚¤ãƒ™ãƒ³ãƒˆæ¤œè¨¼ãƒ»ã‚¨ãƒ³ãƒªãƒƒãƒãƒ¡ãƒ³ãƒˆ âœ… å®Œäº†

### 4.1 æ–°è¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¿½åŠ 

- [x] **4.1.0** feature branchã®å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç¢ºèª âœ…
- [x] **4.1.1** `eventValidation.ts` ã‚’feature branchã‹ã‚‰ã‚³ãƒ”ãƒ¼ âœ…
- [x] **4.1.2** `eventEnrichment.ts` ã‚’feature branchã‹ã‚‰ã‚³ãƒ”ãƒ¼ âœ…
- [x] **4.1.3** `clipEventMatcher.ts` ã‚’feature branchã‹ã‚‰ã‚³ãƒ”ãƒ¼ âœ…
- [x] **4.1.4** `zoneToCoordinate.ts` ã‚’feature branchã‹ã‚‰ã‚³ãƒ”ãƒ¼ âœ…
- [x] **4.1.5** `setPieceOutcomeAnalysis.ts` ã‚’feature branchã‹ã‚‰ã‚³ãƒ”ãƒ¼ âœ…
- [x] **4.1.6** `lib/index.ts` ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’è¿½åŠ  âœ…ï¼ˆlib/index.tsã¯ä¸è¦ - ç›´æ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§å¯¾å¿œï¼‰

### 4.2 deduplication.ts ã®æ›´æ–°

- [x] **4.2.1** RawEvent ã« matchId, videoId, position, positionConfidence ã‚’è¿½åŠ  âœ…
- [x] **4.2.2** DeduplicatedEvent ã« mergedPosition, positionSource, mergedPositionConfidence ã‚’è¿½åŠ  âœ…
- [x] **4.2.3** PositionSource å‹ã« "merged" ã‚’è¿½åŠ  âœ…
- [x] **4.2.4** mergeCluster() ã«ä½ç½®ãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£… âœ…
  - å˜ä¸€ã‚¤ãƒ™ãƒ³ãƒˆ: positionSource = "gemini_output"
  - è¤‡æ•°ã‚¤ãƒ™ãƒ³ãƒˆ: ä¿¡é ¼åº¦åŠ é‡å¹³å‡ã§ãƒãƒ¼ã‚¸ã€positionSource = "merged"

### 4.3 07b_detectEventsWindowed.ts ã®æ›´æ–°

- [x] **4.3.1** RawEvent ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã« matchId, videoId ã‚’è¿½åŠ  âœ…
- [x] **4.3.2** ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆæ™‚ã« matchId ã‚’å«ã‚ã‚‹ âœ…

### 4.4 Phase 4 æ¤œè¨¼

- [x] **4.4.1** TypeScript typecheck æˆåŠŸ âœ…
- [ ] **4.4.2** ã‚¤ãƒ™ãƒ³ãƒˆã«ã‚¨ãƒ³ãƒªãƒƒãƒãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆå¿…è¦ï¼‰

---

## Phase 5: ã‚·ãƒ¼ãƒ³é‡è¦åº¦è¨ˆç®—ã®æ”¹å–„ âœ… å®Œäº†

### 5.1 04_extractImportantScenes.ts ã®æ›´æ–°

- [x] **5.1.0** feature branchã®å®Ÿè£…ã‚’ç¢ºèª âœ…
- [x] **5.1.1** clipEventMatcher ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ âœ…
  ```typescript
  import {
    calculateClipImportance,
    matchClipToEvents,
    type Clip,
    type Event as ClipEvent,
    type EventType,
  } from "../../lib/clipEventMatcher";
  ```
- [x] **5.1.2** enhanceSceneImportance() é–¢æ•°ã‚’è¿½åŠ  âœ…
  ```typescript
  // ã‚¤ãƒ™ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹é‡è¦åº¦ 60% + Geminiã‚ªãƒªã‚¸ãƒŠãƒ« 40%
  const blendedImportance =
    importanceFactors.finalImportance * 0.6 +
    scene.importance * 0.4;
  ```
- [x] **5.1.3** ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—é‡ã¿ä»˜ã‘ã‚’å®Ÿè£… âœ…ï¼ˆclipEventMatcher.ts ã® EVENT_TYPE_WEIGHTS ã‚’ä½¿ç”¨ï¼‰
- [x] **5.1.4** 5ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ã®ä¸¦åˆ—ãƒ•ã‚§ãƒƒãƒã‚’å®Ÿè£… âœ…
  ```typescript
  const [shotEventsSnap, setPieceEventsSnap, passEventsSnap, carryEventsSnap, turnoverEventsSnap] = await Promise.all([...]);
  ```
- [x] **5.1.5** é‡è¦åº¦çµ±è¨ˆã®ãƒ­ã‚°å‡ºåŠ›è¿½åŠ  âœ…
  ```typescript
  const importanceStats = calculateImportanceStats(scenesWithEnhancedImportance);
  // mean, median, min, max, withEventMatches, withoutEventMatches
  ```

### 5.2 shared ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ›´æ–°

- [x] **5.2.1** ImportantSceneDoc ã« videoId ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ  âœ…

### 5.3 Phase 5 æ¤œè¨¼

- [x] **5.3.1** TypeScript typecheck æˆåŠŸ âœ…
- [ ] **5.3.2** ã‚´ãƒ¼ãƒ«ã‚·ãƒ¼ãƒ³ã®é‡è¦åº¦ãŒæœ€ä¸Šä½ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆå¿…è¦ï¼‰
- [ ] **5.3.3** é‡è¦åº¦çµ±è¨ˆãŒãƒ­ã‚°ã«å‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆå¿…è¦ï¼‰

---

## Phase 6: ã‚¢ã‚·ã‚¹ãƒˆè¨˜éŒ²æ©Ÿèƒ½ï¼ˆæ–°è¦å®Ÿè£…ï¼‰ âœ… å®Œäº†

**æ³¨æ„: ã“ã®æ©Ÿèƒ½ã¯ä¸¡ãƒ–ãƒ©ãƒ³ãƒã¨ã‚‚æœªå®Ÿè£…ã€‚æ–°è¦å®Ÿè£…ãŒå¿…è¦ã€‚**

### 6.1 å‹å®šç¾©ã®è¿½åŠ 

- [x] **6.1.1** `packages/shared/src/domain/passEvent.ts` ã« `AssistEventDoc` å‹ã‚’è¿½åŠ  âœ…
  ```typescript
  export type AssistEventDoc = {
    eventId: string;
    matchId: string;
    type: "assist";
    passEventId: string;
    shotEventId: string;
    assistPlayer: { trackId?: string; playerId?: string; teamId: TeamId; player?: string; position?: Point2D; };
    scorerPlayer: { trackId?: string; playerId?: string; teamId: TeamId; player?: string; position?: Point2D; };
    timestamp: number;
    goalTimestamp: number;
    passType?: "short" | "medium" | "long" | "through" | "cross";
    timeDelta: number;
    confidence: number;
    source: "auto" | "manual" | "gemini";
    version: string;
    createdAt: string;
    updatedAt?: string;
  };
  ```

### 6.2 ã‚¢ã‚·ã‚¹ãƒˆæ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…

- [x] **6.2.1** `services/analyzer/src/jobs/steps/07e_detectAssists.ts` ã‚’æ–°è¦ä½œæˆ âœ…
  - `stepDetectAssists()`: ã‚´ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã¨ç›´å‰ã®ãƒ‘ã‚¹ã‚’ç…§åˆã—ã‚¢ã‚·ã‚¹ãƒˆã‚’æ¤œå‡º
  - `findAssistForGoal()`: ã‚´ãƒ¼ãƒ«ã®5ç§’ä»¥å†…ã®å®Œäº†ãƒ‘ã‚¹ã‚’ã‚¢ã‚·ã‚¹ãƒˆå€™è£œã¨ã—ã¦ç‰¹å®š
  - è¨­å®š: `maxTimeDeltaSec: 5.0`, `minConfidence: 0.5`

- [x] **6.2.2** `services/analyzer/src/jobs/runMatchPipeline.ts` ã«ã‚¢ã‚·ã‚¹ãƒˆæ¤œå‡ºã‚¹ãƒ†ãƒƒãƒ—ã‚’çµ±åˆ âœ…
  ```typescript
  // Step 5: Detect assists from goals and passes (Phase 6)
  await runWithRetry("detect_assists", () =>
    stepDetectAssists({ matchId, version: runVersion, logger })
  );
  ```

- [x] **6.2.3** ã‚¢ã‚·ã‚¹ãƒˆæƒ…å ±ã‚’ `assistEvents` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ä¿å­˜ âœ…

### 6.3 ã‚µãƒãƒªãƒ¼ã¸ã®ã‚¢ã‚·ã‚¹ãƒˆåæ˜ 

- [x] **6.3.1** `match_summary_v1.json` ã«ã‚¢ã‚·ã‚¹ãƒˆè¨€åŠæŒ‡ç¤ºã‚’è¿½åŠ  âœ…
  - ã€Œâ˜…â˜…â˜… ã‚´ãƒ¼ãƒ«ã¨ã‚¢ã‚·ã‚¹ãƒˆã®è¨˜éŒ² - å¿…é ˆ â˜…â˜…â˜…ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 
  - `playerHighlights` ã«ã‚¢ã‚·ã‚¹ãƒˆæƒ…å ±ã‚’å«ã‚ã‚‹è¦ä»¶è¿½åŠ 

### 6.4 Phase 6 æ¤œè¨¼

- [x] **6.4.1** TypeScriptãƒ“ãƒ«ãƒ‰æˆåŠŸ âœ…
- [ ] **6.4.2** å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆã§ã‚¢ã‚·ã‚¹ãƒˆãŒæ­£ã—ãæ¤œå‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œï¼‰
- [ ] **6.4.3** ã‚µãƒãƒªãƒ¼ã§ã‚¢ã‚·ã‚¹ãƒˆãŒè¨€åŠã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œï¼‰

---

## Phase 7: æŒ‡å°è€…ãƒ¬ãƒ™ãƒ«æˆ¦è¡“åˆ†æå¼·åŒ–ï¼ˆæ–°è¦å®Ÿè£…ï¼‰ âœ… å®Œäº†

**ç›®æ¨™: ã‚¹ãƒšã‚¤ãƒ³ã€ãƒ–ãƒ©ã‚¸ãƒ«ã€ã‚ªãƒ©ãƒ³ãƒ€ç­‰ã‚µãƒƒã‚«ãƒ¼å…ˆé€²å›½ã®æœ€ä¸Šç´šæŒ‡å°è€…ã®è¦–ç‚¹ã§ã®åˆ†æ**

### 7.1 tactical_analysis_v1.json ã®ã•ã‚‰ãªã‚‹æ”¹å–„ âœ…

- [x] **7.1.1** åˆ†æã®è¦–ç‚¹æŒ‡ç¤ºã‚’è¿½åŠ  âœ…
  - ã€Œâ˜…â˜…â˜… åˆ†æã®è¦–ç‚¹: ã‚¨ãƒªãƒ¼ãƒˆã‚³ãƒ¼ãƒãƒ¬ãƒ™ãƒ« â˜…â˜…â˜…ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ `instructions` ã«è¿½åŠ 
  - ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¨ãƒªã‚¢: ãƒã‚¸ã‚·ãƒ§ãƒŠãƒ«ãƒ—ãƒ¬ãƒ¼ã€ã‚¹ãƒšãƒ¼ã‚¹å‰µå‡ºã€ãƒ—ãƒ¬ã‚¹å›é¿ã€ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒã‚¹ã€ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã€ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ã‚°ãƒ«å½¢æˆã€ã‚µã‚¤ãƒ‰ãƒã‚§ãƒ³ã‚¸ã€ã‚»ã‚«ãƒ³ãƒ‰ãƒœãƒ¼ãƒ«å›å

- [x] **7.1.2** keyInsights ã®å“è³ªåŸºæº–ã‚’è¿½åŠ  âœ…
  - æœ€ä½5ã¤ä»¥ä¸Šã®æ´å¯Ÿã‚’å¿…é ˆè¦ä»¶ã¨ã—ã¦è¿½åŠ 
  - å¿…é ˆé …ç›®: æ•°çš„å„ªä½/åŠ£ä½ã€å¼·ã¿/å¼±ã¿ã®åˆ†æã€æ”¹å–„ãƒã‚¤ãƒ³ãƒˆã€æ”»ç•¥ææ¡ˆã€ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³å•é¡Œç‚¹
  - è¨€èª: å¿…ãšæ—¥æœ¬èªã§è¨˜è¿°ï¼ˆå°‚é–€ç”¨èªã‚‚æ—¥æœ¬èªè¡¨è¨˜ï¼‰

### 7.2 match_summary_v1.json ã®å“è³ªå‘ä¸Š âœ…

- [x] **7.2.1** ã€Œâ˜…â˜…â˜… åˆ†æã®è¦–ç‚¹: ã‚¨ãƒªãƒ¼ãƒˆã‚³ãƒ¼ãƒãƒ¬ãƒ™ãƒ« â˜…â˜…â˜…ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ  âœ…
  - ã‚µãƒƒã‚«ãƒ¼å…ˆé€²å›½ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«æŒ‡å°è€…è¦–ç‚¹ã§ã®åˆ†ææŒ‡ç¤º
  - åˆ†æãƒ•ã‚©ãƒ¼ã‚«ã‚¹: ãƒã‚¸ã‚·ãƒ§ãƒŠãƒ«ãƒ—ãƒ¬ãƒ¼ã€ã‚¹ãƒšãƒ¼ã‚¹æ´»ç”¨ã€ãƒ—ãƒ¬ã‚¹å›é¿ã€å®ˆå‚™ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒã‚¹ã€ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã€ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ã‚°ãƒ«å½¢æˆ
  - ã‚µãƒãƒªãƒ¼å“è³ªåŸºæº–: æˆ¦è¡“çš„æ–‡è„ˆã€ã‚¿ãƒ¼ãƒ‹ãƒ³ã‚°ãƒã‚¤ãƒ³ãƒˆã€é¸æ‰‹ã®å½¹å‰²ã€ã‚³ãƒ¼ãƒãƒ³ã‚°ãƒã‚¤ãƒ³ãƒˆã‚’å«ã‚€

- [x] **7.2.2** ã€Œâ˜…â˜…â˜… ã‚´ãƒ¼ãƒ«ã¨ã‚¢ã‚·ã‚¹ãƒˆã®è¨˜éŒ² - å¿…é ˆ â˜…â˜…â˜…ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ  âœ…
  - ã‚´ãƒ¼ãƒ«ã‚·ãƒ¼ãƒ³ã®å¿…é ˆè¨€åŠï¼ˆå¾—ç‚¹çµŒç·¯ã€é¸æ‰‹åã€æ™‚é–“å¸¯ï¼‰
  - ã‚¢ã‚·ã‚¹ãƒˆæƒ…å ±ã®è¨˜è¼‰è¦ä»¶
  - playerHighlightsã¸ã®ã‚´ãƒ¼ãƒ«/ã‚¢ã‚·ã‚¹ãƒˆæƒ…å ±åæ˜ 

### 7.3 æˆ¦è¡“ç”¨èªã®æ—¥æœ¬èªçµ±ä¸€ âœ…

- [x] **7.3.1** `instructions`å†…ã«æ—¥æœ¬èªä½¿ç”¨æŒ‡ç¤ºã‚’çµ„ã¿è¾¼ã¿ âœ…
  - ã€Œå¿…ãšæ—¥æœ¬èªã§è¨˜è¿°ã€
  - ã€Œå°‚é–€ç”¨èªã‚‚æ—¥æœ¬èªè¡¨è¨˜ï¼ˆãƒã‚¼ãƒƒã‚·ãƒ§ãƒ³ã€ãƒ—ãƒ¬ã‚¹ã€ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ç­‰ï¼‰ã€

### 7.4 Phase 7 æ¤œè¨¼

- [x] **7.4.1** JSONãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸ âœ…
- [x] **7.4.2** TypeScriptãƒ“ãƒ«ãƒ‰æˆåŠŸ âœ…
- [ ] **7.4.3** å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆã§æˆ¦è¡“åˆ†æãŒæ—¥æœ¬èªã§å‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œï¼‰
- [ ] **7.4.4** keyInsightsãŒ5ã¤ä»¥ä¸Šã§å…·ä½“çš„ãªå†…å®¹ã‚’å«ã‚€ã“ã¨ã‚’ç¢ºèªï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œï¼‰

---

## Phase 8: ã‚¤ãƒ™ãƒ³ãƒˆä½ç½®â†’ã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒ“ãƒ¥ãƒ¼UIåæ˜ ï¼ˆæ–°è¦å®Ÿè£…ï¼‰ âœ… å®Œäº†

### 8.1 ç¾çŠ¶ç¢ºèª

**æ—¢å­˜å®Ÿè£…:**
- `livePositions` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ â†’ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½ç½® â†’ TacticalView ã«è¡¨ç¤ºæ¸ˆã¿
- ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆpassEvents, shotEventsç­‰ï¼‰ã® position ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ â†’ **UIæœªåæ˜ **

### 8.2 ã‚¤ãƒ™ãƒ³ãƒˆä½ç½®ã®å¯è¦–åŒ– âœ…

- [x] **8.2.1** `apps/mobile/lib/hooks/useMatchEvents.ts` ã‚’æ–°è¦ä½œæˆ âœ…
  - passEvents, shotEvents, turnoverEvents, setPieceEvents ã‹ã‚‰ã‚¤ãƒ™ãƒ³ãƒˆå–å¾—
  - 0-100æ­£è¦åŒ–åº§æ¨™ã‹ã‚‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åº§æ¨™ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰ã¸ã®å¤‰æ›
  - ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã€ãƒãƒ¼ãƒ ã€ä¿¡é ¼åº¦é–¾å€¤ã€æ™‚é–“ç¯„å›²ï¼‰

- [x] **8.2.2** `apps/mobile/components/TacticalView.tsx` ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ¼ã‚«ãƒ¼è¿½åŠ  âœ…
  ```typescript
  // è¿½åŠ ã•ã‚ŒãŸãƒ—ãƒ­ãƒƒãƒ—ã‚¹
  events?: EventMarker[];
  showEvents?: boolean;
  onEventTap?: (eventId: string) => void;
  ```

- [x] **8.2.3** ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—åˆ¥ã®ã‚¢ã‚¤ã‚³ãƒ³/è‰²ã‚’å®šç¾© âœ…
  ```typescript
  // getEventMarkerStyle() é–¢æ•°ã§å®Ÿè£…
  shot: { icon: "âš½" (goal) / "â—" (other), backgroundColor: "#FFD700" (goal) / teamColor }
  pass: { icon: "â†’", backgroundColor: green (complete) / orange (incomplete) }
  turnover: { icon: "Ã—" (lost) / "âœ“" (won), backgroundColor: red / green }
  setPiece: { icon: "ğŸš©", backgroundColor: purple }
  ```

- [x] **8.2.4** `apps/mobile/app/match/[id]/tactical.tsx` ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½è¿½åŠ  âœ…
  - è¡¨ç¤ºON/OFFã‚¹ã‚¤ãƒƒãƒ
  - ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ï¼ˆã‚·ãƒ¥ãƒ¼ãƒˆã€ãƒ‘ã‚¹ã€ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼ã€ã‚»ãƒƒãƒˆãƒ—ãƒ¬ãƒ¼ï¼‰
  - è¡¨ç¤ºä»¶æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
  - å‡¡ä¾‹ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ¼ã‚«ãƒ¼èª¬æ˜è¿½åŠ 

### 8.3 ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—æ©Ÿèƒ½ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

- [ ] **8.3.1** é¸æ‰‹åˆ¥ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä½ç½®ã‚’ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã§è¡¨ç¤ºï¼ˆå°†æ¥å®Ÿè£…ï¼‰
- [ ] **8.3.2** ãƒãƒ¼ãƒ åˆ¥ã®æ´»å‹•ã‚¨ãƒªã‚¢ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤ºï¼ˆå°†æ¥å®Ÿè£…ï¼‰

### 8.4 Phase 8 æ¤œè¨¼

- [x] **8.4.1** TypeScriptãƒ“ãƒ«ãƒ‰æˆåŠŸ âœ…
- [ ] **8.4.2** å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆã§ã‚¤ãƒ™ãƒ³ãƒˆä½ç½®ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œï¼‰
- [ ] **8.4.3** ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œï¼‰

---

## Phase 9: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è­˜åˆ¥ç²¾åº¦å‘ä¸Š âœ… å®Œäº†

### 9.1 player_identification_v2.json ã®è¿½åŠ 

- [x] **9.1.1** feature branchã‹ã‚‰v2ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ âœ…
- [x] **9.1.2** ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è­˜åˆ¥æˆ¦ç•¥ã‚’ç¢ºèª âœ…
  - ä½“å‹ï¼ˆtall/average/shortï¼‰
  - é«ªè‰²ï¼ˆhexï¼‰
  - ãƒã‚¸ã‚·ãƒ§ãƒ³å‚¾å‘ï¼ˆdefender/midfielder/forward/goalkeeperï¼‰
  - ãƒãƒ¼ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆprimary/secondary hexï¼‰

### 9.2 playerConfidenceCalculator.ts ã®è¿½åŠ 

- [x] **9.2.1** feature branchã‹ã‚‰ã‚³ãƒ”ãƒ¼ âœ…
- [x] **9.2.2** è¤‡åˆä¿¡é ¼åº¦è¨ˆç®—ã‚’ç¢ºèª âœ…
  ```typescript
  CONFIDENCE_WEIGHTS = {
    ocr: 0.5,           // OCRä¿¡é ¼åº¦ 50%
    teamMatching: 0.25, // ãƒãƒ¼ãƒ ãƒãƒƒãƒãƒ³ã‚° 25%
    tracking: 0.25,     // ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ä¸€è²«æ€§ 25%
  }
  ```
- [x] **9.2.3** ä¸»è¦é–¢æ•° âœ…
  - `calculatePlayerConfidence()` - ç·åˆä¿¡é ¼åº¦è¨ˆç®—
  - `selectBestPlayerCandidate()` - æœ€é©å€™è£œé¸æŠ
  - `calculatePlayerIdentificationStats()` - è­˜åˆ¥çµ±è¨ˆ
  - `validatePlayerEventLinkage()` - ã‚¤ãƒ™ãƒ³ãƒˆãƒªãƒ³ã‚±ãƒ¼ã‚¸æ¤œè¨¼

### 9.3 playerTrackMatcher.ts ã®è¿½åŠ 

- [x] **9.3.1** feature branchã‹ã‚‰ã‚³ãƒ”ãƒ¼ âœ…
- [x] **9.3.2** é‡è¤‡ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¢ºèª âœ…
  - `deduplicatePlayers()` - é‡è¤‡æ’é™¤
  - `isSamePlayer()` - åŒä¸€é¸æ‰‹åˆ¤å®š
  - `mergePlayerDetections()` - æ¤œå‡ºãƒãƒ¼ã‚¸
  - `validateJerseyNumberConsistency()` - èƒŒç•ªå·ä¸€è²«æ€§æ¤œè¨¼

### 9.4 Phase 9 æ¤œè¨¼

- [x] **9.4.1** TypeScript typecheck æˆåŠŸ âœ…
- [ ] **9.4.2** å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆã§ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è­˜åˆ¥ãŒæ”¹å–„ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œï¼‰

---

## Phase 10: æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

### 10.1 ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒãƒ†ã‚¹ãƒˆ

- [ ] **10.1.1** Cloud Buildã§ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ
- [ ] **10.1.2** ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§8äººåˆ¶å‹•ç”»ãƒ†ã‚¹ãƒˆ
- [ ] **10.1.3** ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚´ãƒ¼ãƒ«æ¤œå‡ºã€ã‚¢ã‚·ã‚¹ãƒˆã€ã‚¤ãƒ™ãƒ³ãƒˆæ•°ã‚’ç¢ºèª

### 10.2 æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

- [ ] **10.2.1** mainãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸
- [ ] **10.2.2** Cloud Buildæœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
- [ ] **10.2.3** Cloud Runç’°å¢ƒå¤‰æ•°ç¢ºèª

### 10.3 æœ¬ç•ªæ¤œè¨¼

- [ ] **10.3.1** æœ¬ç•ªç’°å¢ƒã§æ–°è¦åˆ†æå®Ÿè¡Œ
- [ ] **10.3.2** 8äººåˆ¶ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£ã—ãå‡ºåŠ›ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] **10.3.3** ã‚´ãƒ¼ãƒ«ã‚·ãƒ¼ãƒ³ãƒ»ã‚¢ã‚·ã‚¹ãƒˆãŒã‚µãƒãƒªãƒ¼ã«å«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] **10.3.4** ã‚¤ãƒ™ãƒ³ãƒˆèª¤æ¤œå‡ºãŒæ¸›å°‘ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] **10.3.5** æˆ¦è¡“åˆ†æãŒæ—¥æœ¬èªã§æŒ‡å°è€…ãƒ¬ãƒ™ãƒ«ã®å“è³ªã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] **10.3.6** ã‚¤ãƒ™ãƒ³ãƒˆä½ç½®ãŒã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒ“ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

---

## å‚è€ƒ: ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### å¤‰æ›´å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆfeature branchã‹ã‚‰ç§»æ¤ï¼‰

```
services/analyzer/src/gemini/prompts/
â”œâ”€â”€ tactical_analysis_v1.json      # Phase 1.1
â”œâ”€â”€ match_summary_v1.json          # Phase 1.2
â”œâ”€â”€ event_detection_v3.json        # Phase 1.3
â”œâ”€â”€ event_detection_v4.json        # Phase 3.1 (æ–°è¦)
â””â”€â”€ player_identification_v2.json  # Phase 9.1 (æ–°è¦)

services/analyzer/src/gemini/
â”œâ”€â”€ gemini3Client.ts               # Phase 2.2
â””â”€â”€ summaryAndTactics.ts           # Phase 2.3

services/analyzer/src/jobs/steps/
â”œâ”€â”€ 04_extractImportantScenes.ts   # Phase 5.1
â”œâ”€â”€ 07b_detectEventsWindowed.ts    # Phase 2.1, 3.2
â””â”€â”€ 07c_deduplicateEvents.ts       # Phase 4.2

services/analyzer/src/lib/
â”œâ”€â”€ eventValidation.ts             # Phase 4.1 (æ–°è¦)
â”œâ”€â”€ eventEnrichment.ts             # Phase 4.1 (æ–°è¦)
â”œâ”€â”€ clipEventMatcher.ts            # Phase 4.1 (æ–°è¦)
â”œâ”€â”€ zoneToCoordinate.ts            # Phase 4.1 (æ–°è¦)
â”œâ”€â”€ setPieceOutcomeAnalysis.ts     # Phase 4.1 (æ–°è¦)
â”œâ”€â”€ playerConfidenceCalculator.ts  # Phase 9.2 (æ–°è¦)
â”œâ”€â”€ playerTrackMatcher.ts          # Phase 9.3 (æ–°è¦)
â”œâ”€â”€ assistDetection.ts             # Phase 6.2 (â˜…æ–°è¦å®Ÿè£…)
â””â”€â”€ index.ts                       # Phase 4.1

packages/shared/src/domain/
â”œâ”€â”€ passEvent.ts                   # Phase 4.3, 6.1
â”œâ”€â”€ shotEvent.ts                   # Phase 6.1 (â˜…æ–°è¦å®Ÿè£…)
â””â”€â”€ metricKeys.ts                  # Phase 6.1 (â˜…æ–°è¦å®Ÿè£…)
```

### æ–°è¦è¿½åŠ ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆfeature branchã«ã‚‚å­˜åœ¨ã—ãªã„ï¼‰

```
services/analyzer/src/lib/
â””â”€â”€ assistDetection.ts             # Phase 6.2 (â˜…å®Œå…¨æ–°è¦)

apps/mobile/components/
â””â”€â”€ EventMarkers.tsx               # Phase 8.2 (â˜…å®Œå…¨æ–°è¦)
```

---

## å®Œäº†æ¡ä»¶

- [ ] 8äººåˆ¶ã‚µãƒƒã‚«ãƒ¼å‹•ç”»ã§é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ3-3-1ç­‰ï¼‰ãŒå‡ºåŠ›ã•ã‚Œã‚‹
- [ ] ã‚´ãƒ¼ãƒ«ã‚·ãƒ¼ãƒ³ãŒãƒãƒƒãƒã‚µãƒãƒªãƒ¼ã®keyMomentsã«å«ã¾ã‚Œã‚‹
- [ ] **ã‚¢ã‚·ã‚¹ãƒˆãŒæ­£ã—ãæ¤œå‡ºãƒ»è¨˜éŒ²ã•ã‚Œã‚‹**
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆèª¤æ¤œå‡ºç‡ãŒ50%ä»¥ä¸Šå‰Šæ¸›ã•ã‚Œã‚‹
- [ ] **æˆ¦è¡“åˆ†æãŒ100%æ—¥æœ¬èªã§ã€æŒ‡å°è€…ãƒ¬ãƒ™ãƒ«ã®æ·±ã•ã‚’æŒã¤**
- [ ] **ã‚¤ãƒ™ãƒ³ãƒˆä½ç½®ãŒã‚¿ã‚¯ãƒ†ã‚£ã‚«ãƒ«ãƒ“ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹**
- [ ] å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹
- [ ] æœ¬ç•ªç’°å¢ƒã§æ­£å¸¸å‹•ä½œã™ã‚‹

---

## å„ªå…ˆåº¦é †åº

1. **Phase 1** (å³åŠ¹æ€§): ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ›´æ–° â†’ 8äººåˆ¶å¯¾å¿œã€ã‚´ãƒ¼ãƒ«æ¤œå‡º
2. **Phase 2** (ç²¾åº¦å‘ä¸Š): é–¾å€¤èª¿æ•´ â†’ ã‚¤ãƒ™ãƒ³ãƒˆèª¤æ¤œå‡ºå‰Šæ¸›
3. **Phase 7** (å“è³ªå‘ä¸Š): æŒ‡å°è€…ãƒ¬ãƒ™ãƒ«åˆ†æ â†’ æˆ¦è¡“åˆ†æã®æ·±ã•
4. **Phase 6** (æ–°æ©Ÿèƒ½): ã‚¢ã‚·ã‚¹ãƒˆè¨˜éŒ²
5. **Phase 3-5** (æ©Ÿèƒ½æ‹¡å¼µ): ä½ç½®æ¨å®šã€æ¤œè¨¼ã€ã‚·ãƒ¼ãƒ³é‡è¦åº¦
6. **Phase 8** (UI): ã‚¤ãƒ™ãƒ³ãƒˆä½ç½®å¯è¦–åŒ–
7. **Phase 9** (ã‚ªãƒ—ã‚·ãƒ§ãƒ³): ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è­˜åˆ¥
8. **Phase 10** (æœ€çµ‚): ãƒ‡ãƒ—ãƒ­ã‚¤
